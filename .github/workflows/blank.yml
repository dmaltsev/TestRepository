# This is a basic workflow to help you get started with Actions

name: CI

on:
  pull_request:
    types: [labeled, ready_for_review]
  pull_request_review:
    types: [edited, dismissed, submitted]

jobs:
  check:    
    runs-on: [self-hosted]
    outputs:
      status: steps.reviews.outputs.approved >= 2 && steps.reviews.outputs.changes_requested == 0
    steps:
    - id: reviews
      uses: jrylan/github-action-reviews-counter@v1.0.0
      with:
        repo-token: '${{ secrets.TOKEN }}'

  build:
    runs-on: [self-hosted]
    needs: check
 
    if: needs.check.outputs.status == 'true'
     
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Run Fastlane Autotest
      run: fastlane autotest
